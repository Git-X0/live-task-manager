<div class="container max-w-3xl mx-auto">
  <div
    class="glass-card bg-white/85 backdrop-blur-lg rounded-2xl p-8 shadow-xl border border-white/40"
  >
    <h2
      class="header text-center mb-8 text-[#5e35b1] font-bold text-3xl relative pb-3"
    >
      Můj Task Manager ✨
      <span
        class="absolute bottom-0 left-1/2 transform -translate-x-1/2 w-24 h-1 bg-gradient-to-r from-[#6e8efb] to-[#a777e3] rounded-full"
      ></span>
    </h2>

    <div class="add-task flex gap-4 mb-8">
      <input
        #newTaskInput
        [value]="newTask()"
        (input)="newTask.set($any($event.target).value)"
        (keyup.enter)="addTask()"
        class="task-input flex-1 p-5 rounded-xl bg-white/70 shadow-md text-lg transition-all duration-300 focus:shadow-lg focus:bg-white focus:translate-y-[-2px]"
        type="text"
        placeholder="Napiš úkol..."
      />
      <button
        class="add-button bg-gradient-to-br from-[#6e8efb] to-[#a777e3] text-white rounded-xl w-16 h-16 flex items-center justify-center shadow-lg transition-all duration-300 hover:scale-105 hover:shadow-xl"
        (click)="addTask()"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="3"
          stroke-width="3"
        >
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
      </button>
    </div>

    <div class="filters">
      <button [class.active]="filter() === 'all'" (click)="filter.set('all')">
        Vše
      </button>
      <button
        [class.active]="filter() === 'active'"
        (click)="filter.set('active')"
      >
        Aktivní
      </button>
      <button
        [class.active]="filter() === 'completed'"
        (click)="filter.set('completed')"
      >
        Splněné
      </button>
      <button class="clear-button" (click)="clearCompleted()">
        Smazat splněné
      </button>
    </div>

    <ul class="task-list" cdkDropList (cdkDropListDropped)="drop($event)">
      @for (task of filteredTasks(); track task.id) {
      <li
        class="task-item relative p-6 bg-white rounded-2xl mb-4 shadow-md transition-all duration-300 hover:translate-y-[-5px] hover:shadow-lg"
        [class.completed]="task.completed"
        [attr.data-task-id]="task.id"
        cdkDrag
      >
        <label class="custom-checkbox">
          <input
            type="checkbox"
            [checked]="task.completed"
            (change)="toggleTask(task.id)"
            class="checkbox-input"
          />
          <span class="checkmark"></span>
        </label>

        @if (editingId() === task.id) {
        <input
          #editInput
          class="edit-input"
          type="text"
          [value]="editingText()"
          (input)="editingText.set($any($event.target).value)"
          (blur)="saveEdit(task.id)"
          (keyup.enter)="saveEdit(task.id)"
          autofocus
        />
        } @else {
        <span class="task-text" (dblclick)="startEdit(task)">
          {{ task.text }}
        </span>
        }

        <button class="delete-button" (click)="removeTask(task.id)">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="22"
            height="22"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2.5"
          >
            <polyline points="3 6 5 6 21 6"></polyline>
            <path
              d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
            ></path>
            <line x1="10" y1="11" x2="10" y2="17"></line>
            <line x1="14" y1="11" x2="14" y2="17"></line>
          </svg>
        </button>
      </li>
      } @empty {
      <li class="empty-state">
        <svg class="empty-icon" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="8" x2="12" y2="12"></line>
          <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
        <p>Žádné úkoly k zobrazení</p>
        <small>Začněte přidáním nového úkolu</small>
      </li>
      }
    </ul>

    <div class="footer pt-6 border-t border-t-black/5">
      <p
        class="remaining text-center text-[#5e35b1] text-xl font-semibold mb-4"
      >
        Zbývá:
        <strong
          class="font-extrabold bg-clip-text text-transparent bg-gradient-to-r from-[#6e8efb] to-[#a777e3]"
          >{{ remainingCount() }}</strong
        >
        úkolů
      </p>
      <div
        class="progress-bar h-3 bg-black/5 rounded-xl overflow-hidden shadow-inner"
      >
        <div
          class="progress h-full bg-gradient-to-r from-[#6e8efb] to-[#a777e3] rounded-xl transition-all duration-500"
          [style.width.%]="progress()"
        ></div>
      </div>
    </div>
  </div>
</div>
