<div class="container">
  <div class="glass-card">
    <h2 class="header">Můj Task Manager ✨</h2>

    <div class="add-task">
      <input
        #newTaskInput
        class="task-input"
        type="text"
        placeholder="Napiš úkol..."
        [value]="newTask()"
        (input)="newTask.set($any($event.target).value)"
        (keyup.enter)="addTask()"
      />
      <button class="add-button" (click)="addTask()">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="3"
        >
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
      </button>
    </div>

    <div class="filters">
      <button [class.active]="filter() === 'all'" (click)="filter.set('all')">
        Vše
      </button>
      <button
        [class.active]="filter() === 'active'"
        (click)="filter.set('active')"
      >
        Aktivní
      </button>
      <button
        [class.active]="filter() === 'completed'"
        (click)="filter.set('completed')"
      >
        Splněné
      </button>
      <button class="clear-button" (click)="clearCompleted()">
        Smazat splněné
      </button>
    </div>

    <ul class="task-list" cdkDropList (cdkDropListDropped)="drop($event)">
      @for (task of filteredTasks(); track task.id) {
      <li
        class="task-item"
        [class.completed]="task.completed"
        [attr.data-task-id]="task.id"
        cdkDrag
      >
        <label class="custom-checkbox">
          <input
            type="checkbox"
            [checked]="task.completed"
            (change)="toggleTask(task.id)"
            class="checkbox-input"
          />
          <span class="checkmark"></span>
        </label>

        @if (editingId() === task.id) {
        <input
          #editInput
          class="edit-input"
          type="text"
          [value]="editingText()"
          (input)="editingText.set($any($event.target).value)"
          (blur)="saveEdit(task.id)"
          (keyup.enter)="saveEdit(task.id)"
          autofocus
        />
        } @else {
        <span class="task-text" (dblclick)="startEdit(task)">
          {{ task.text }}
        </span>
        }

        <button class="delete-button" (click)="removeTask(task.id)">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="22"
            height="22"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2.5"
          >
            <polyline points="3 6 5 6 21 6"></polyline>
            <path
              d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
            ></path>
            <line x1="10" y1="11" x2="10" y2="17"></line>
            <line x1="14" y1="11" x2="14" y2="17"></line>
          </svg>
        </button>
      </li>
      } @empty {
      <li class="empty-state">
        <svg class="empty-icon" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="8" x2="12" y2="12"></line>
          <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
        <p>Žádné úkoly k zobrazení</p>
        <small>Začněte přidáním nového úkolu</small>
      </li>
      }
    </ul>

    <div class="footer">
      <p class="remaining">
        Zbývá: <strong>{{ remainingCount() }}</strong> úkolů
      </p>
      <div class="progress-bar">
        <div class="progress" [style.width.%]="progress()"></div>
      </div>
    </div>
  </div>
</div>
